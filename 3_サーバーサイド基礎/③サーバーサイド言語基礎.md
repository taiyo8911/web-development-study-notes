**目標：PHPでフォーム処理とデータ保存ができるようになる**

---

## 🗺️ 学習の全体像

| 章 | 内容 | 実践内容 | 所要時間 |
| --- | --- | --- | --- |
| 第1章 | サーバーサイドとは何か | フロントエンドとの違いを理解 | 1時間 |
| 第2章 | PHPの基礎文法 | 変数・関数・配列を学ぶ | 2時間 |
| 第3章 | フォーム処理の基本 | GET/POSTでデータを受け取る | 2時間 |
| 第4章 | ファイル操作 | JSONでデータ保存 | 2時間 |
| 第5章 | 総合演習：簡易掲示板 | 学んだことを統合して実装 | 3時間 |

**合計学習時間：約10時間（2週間）**

---

## 第1章｜サーバーサイドとは何か

### 💡 1-1. フロントエンドとサーバーサイドの違い

```
[ブラウザ（クライアント）]          [サーバー]
┌─────────────────┐           ┌─────────────────┐
│  HTML/CSS/JS    │リクエスト→　│      PHP        │
│  見た目・動き     │　　　　　　 │　データ処理　　　  │
│                 │←レスポンス　│　DB操作          │
│ ユーザーが見える　 │           │ ユーザーは見えない │
└─────────────────┘           └─────────────────┘
```

### 📊 比較表

| 項目 | フロントエンド | サーバーサイド |
| --- | --- | --- |
| **実行場所** | ユーザーのブラウザ | サーバー |
| **役割** | 見た目・動き | データ処理・保存 |
| **言語** | HTML/CSS/JavaScript | PHP/Python/Node.js等 |
| **コード** | 見える | 見えない（セキュア） |
| **データ保存** | できない | できる |

### 🤔 1-2. なぜサーバーサイドが必要なのか？

**JavaScriptだけでは実現できないこと：**

1. **データの永続的な保存**
   - ❌ JavaScript: ブラウザを閉じたら消える
   - ✅ PHP: サーバーにずっと保存される

2. **ユーザー間でのデータ共有**
   - ❌ JavaScript: 自分だけしか見れない
   - ✅ PHP: 他のユーザーも見れる（掲示板、SNS等）

3. **セキュリティが必要な処理**
   - ❌ JavaScript: コードが丸見え
   - ✅ PHP: コードが見えないので安全

**具体例：**

```javascript
// ❌ JavaScript（ブラウザを閉じたら消える）
let posts = [];
posts.push(message);  // ブラウザだけに保存
```

```php
// ✅ PHP（サーバーに永続保存）
$posts = json_decode(file_get_contents('posts.json'), true);
$posts[] = $message;
file_put_contents('posts.json', json_encode($posts));  // ファイルに保存
```

### 🔄 1-3. 通信の流れ

**ステップ②のポケモン図鑑を思い出してください：**

```
① [ブラウザ] JavaScript が fetch() を実行
     ↓
② [インターネット] リクエストがサーバーに送られる
     ↓
③ [サーバー] PHPがリクエストを処理
     ↓
④ [データベース] 必要ならデータを取得
     ↓
⑤ [サーバー] JSONデータを作成
     ↓
⑥ [ブラウザ] JavaScript が受け取って画面に表示
```

**今まで学んだこと：** ①と⑥（フロントエンド）
**これから学ぶこと：** ③〜⑤（サーバーサイド）

### 📊 1-4. GETとPOSTの違い

| 項目 | GET | POST |
| --- | --- | --- |
| **用途** | データ取得 | データ送信 |
| **データの場所** | URLに見える | 見えない |
| **例** | `search.php?keyword=猫` | ログイン・投稿 |
| **セキュリティ** | 低い | 高い |

**HTMLでの書き方：**

```html
<!-- GET: 検索など -->
<form action="search.php" method="GET">
  <input type="text" name="keyword">
  <button>検索</button>
</form>

<!-- POST: ログイン・投稿など -->
<form action="login.php" method="POST">
  <input type="password" name="password">
  <button>ログイン</button>
</form>
```

---

## 第2章｜PHPの基礎文法

### 💡 2-1. PHPとは？

サーバーサイドで動くプログラミング言語です。

**JavaScriptとの違い：**

| 特徴 | JavaScript | PHP |
| --- | --- | --- |
| **実行場所** | ブラウザ | サーバー |
| **ファイル拡張子** | `.js` | `.php` |
| **変数の書き方** | `let name = "太郎"` | `$name = "太郎"` |

### 🖥️ 2-2. 環境構築

**macには最初からPHPが入っています！**

```bash
# バージョン確認
php -v

# 作業フォルダを作成
mkdir ~/Desktop/php-practice
cd ~/Desktop/php-practice

# サーバー起動
php -S localhost:8000
```

ブラウザで `http://localhost:8000` にアクセス

### 📝 2-3. 基本構文

```php
<?php
  echo "Hello, PHP!";
?>
```

**HTMLと組み合わせる：**

```php
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>PHPテスト</title>
</head>
<body>
  <h1><?php echo "こんにちは"; ?></h1>
  
  <?php
    $name = "太郎";
    echo "<p>{$name}さん</p>";
  ?>
</body>
</html>
```

### 🔢 2-4. 変数とデータ型

```php
<?php
  // 文字列
  $message = "こんにちは";

  // 数値
  $count = 100;

  // 配列
  $fruits = ["りんご", "バナナ", "みかん"];

  // 連想配列（JavaScriptのオブジェクトに似ている）
  $person = [
    "name" => "太郎",
    "age" => 25
  ];

  // 値を取得
  echo $fruits[0];        // りんご
  echo $person["name"];   // 太郎
?>
```

### 🔧 2-5. 関数

```php
<?php
  function greet($name) {
    return "こんにちは、{$name}さん";
  }

  echo greet("太郎");  // こんにちは、太郎さん
?>
```

### 🔁 2-6. ループ

```php
<?php
  $fruits = ["りんご", "バナナ", "みかん"];

  foreach ($fruits as $fruit) {
    echo $fruit . "<br>";
  }
?>
```

### ✏️ 実践1：自己紹介ページを作る

**課題：** `profile.php`を作成してください。

```php
<?php
  $name = "あなたの名前";
  $age = 25;
  $hobbies = ["読書", "プログラミング", "散歩"];
?>
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title><?php echo $name; ?>の自己紹介</title>
</head>
<body>
  <h1><?php echo $name; ?></h1>
  <p>年齢: <?php echo $age; ?>歳</p>

  <h2>趣味</h2>
  <ul>
    <?php foreach ($hobbies as $hobby): ?>
      <li><?php echo $hobby; ?></li>
    <?php endforeach; ?>
  </ul>
</body>
</html>
```

---

## 第3章｜フォーム処理の基本

### 📥 3-1. GETでデータを受け取る

**search.html**

```html
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>検索フォーム</title>
</head>
<body>
  <h1>検索</h1>
  <form action="search.php" method="GET">
    <input type="text" name="keyword" placeholder="検索ワードを入力">
    <button type="submit">検索</button>
  </form>
</body>
</html>
```

**search.php**

```php
<?php
  // GETパラメータを取得
  $keyword = $_GET['keyword'] ?? '';
  
  // XSS対策（必須！）
  $safe_keyword = htmlspecialchars($keyword, ENT_QUOTES, 'UTF-8');
?>
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>検索結果</title>
</head>
<body>
  <h1>検索結果</h1>
  <?php if (!empty($safe_keyword)): ?>
    <p>「<?php echo $safe_keyword; ?>」の検索結果</p>
  <?php else: ?>
    <p>検索ワードを入力してください</p>
  <?php endif; ?>
</body>
</html>
```

**重要：** ユーザー入力は必ず`htmlspecialchars()`でエスケープ！

```php
// ❌ 危険
echo $_GET['keyword'];

// ✅ 安全
echo htmlspecialchars($_GET['keyword'], ENT_QUOTES, 'UTF-8');
```

### 📤 3-2. POSTでデータを受け取る

**register.html**

```html
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>会員登録</title>
</head>
<body>
  <h1>会員登録</h1>
  <form action="register.php" method="POST">
    <input type="text" name="name" placeholder="名前" required><br>
    <input type="email" name="email" placeholder="メールアドレス" required><br>
    <input type="password" name="password" placeholder="パスワード" required><br>
    <button type="submit">登録</button>
  </form>
</body>
</html>
```

**register.php**

```php
<?php
  $name = $_POST['name'] ?? '';
  $email = $_POST['email'] ?? '';
  $password = $_POST['password'] ?? '';

  // バリデーション
  $errors = [];

  if (empty($name)) {
    $errors[] = "名前を入力してください";
  }

  if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
    $errors[] = "メールアドレスが無効です";
  }

  if (strlen($password) < 8) {
    $errors[] = "パスワードは8文字以上";
  }

  // エラーがなければ保存
  if (count($errors) === 0) {
    $user_data = [
      'name' => htmlspecialchars($name, ENT_QUOTES, 'UTF-8'),
      'email' => htmlspecialchars($email, ENT_QUOTES, 'UTF-8'),
      'password' => password_hash($password, PASSWORD_DEFAULT),
      'registered_at' => date('Y-m-d H:i:s')
    ];

    // JSONファイルに保存
    $json = json_encode($user_data, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);
    file_put_contents('user.json', $json);

    // 完了ページにリダイレクト
    header('Location: complete.php');
    exit;
  }
?>
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>登録エラー</title>
</head>
<body>
  <h1>エラーが発生しました</h1>
  <?php foreach ($errors as $error): ?>
    <p style="color: red;"><?php echo $error; ?></p>
  <?php endforeach; ?>
  <a href="register.html">戻る</a>
</body>
</html>
```

### 🔒 3-3. セキュリティの基本

**必ず守るべきルール：**

1. ✅ ユーザー入力は必ず`htmlspecialchars()`でエスケープ
2. ✅ パスワードは`password_hash()`でハッシュ化
3. ✅ メールアドレスは`filter_var()`で検証
4. ✅ POST後は`header('Location: ...')`でリダイレクト

---

## 第4章｜ファイル操作

### 🗃️ 4-1. JSONでデータ保存

**なぜJSONを使う？**

- 軽量で読みやすい
- JavaScriptと互換性がある
- データベースなしで簡単にデータ保存できる

```php
<?php
  // 配列をJSONで保存
  $users = [
    ['name' => '太郎', 'age' => 25],
    ['name' => '花子', 'age' => 23]
  ];

  // JSON形式に変換してファイルに保存
  $json = json_encode($users, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);
  file_put_contents('users.json', $json);

  // JSONを読み込み
  $json = file_get_contents('users.json');
  $users = json_decode($json, true);

  // データを使う
  foreach ($users as $user) {
    echo $user['name'] . "さん<br>";
  }
?>
```

**保存される`users.json`の中身：**

```json
[
  {
    "name": "太郎",
    "age": 25
  },
  {
    "name": "花子",
    "age": 23
  }
]
```

### ✏️ 実践2：データの保存と読み込みを試す

**課題：** 以下を実装してください。

1. `save.php`：名前と年齢をPOSTで受け取り、JSONファイルに保存
2. `list.php`：保存されたデータを一覧表示

**成果物：**
[メンバーリストアプリ](https://taiyo8911.cloudfree.jp/myapp/member-registry)

---

## 第5章｜総合演習：簡易掲示板

### 🎯 5-1. 完成イメージ

**機能：**

- 投稿（名前・メッセージ）
- 一覧表示（新しい順）
- 削除
- JSONで保存

### 💻 5-2. 実装

**board.php**

```php
<?php
$data_file = 'posts.json';

// 初期化：ファイルがなければ作成
if (!file_exists($data_file)) {
  file_put_contents($data_file, json_encode([]));
}

// JSONファイルからデータを読み込み
$posts = json_decode(file_get_contents('posts.json'), true);

// nullの場合は空の配列にする
if ($posts === null) {
    $posts = [];
}

// 投稿処理
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action'])) {
  
  if ($_POST['action'] === 'post') {
    $name = $_POST['name'] ?? '';
    $message = $_POST['message'] ?? '';

    if (!empty($name) && !empty($message)) {
      $new_post = [
        'id' => uniqid(),
        'name' => htmlspecialchars($name, ENT_QUOTES, 'UTF-8'),
        'message' => htmlspecialchars($message, ENT_QUOTES, 'UTF-8'),
        'created_at' => date('Y-m-d H:i:s')
      ];

      array_unshift($posts, $new_post);
      file_put_contents($data_file, json_encode($posts, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT));
    }

    header('Location: index.php');
    exit;
  }

  if ($_POST['action'] === 'delete') {
    $delete_id = $_POST['id'] ?? '';
    $posts = array_filter($posts, fn($p) => $p['id'] !== $delete_id);
    $posts = array_values($posts);
    file_put_contents($data_file, json_encode($posts, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT));

    header('Location: index.php');
    exit;
  }
}
?>
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>簡易掲示板</title>
</head>
<body>
  <h1>📝 簡易掲示板</h1>

  <!-- 投稿フォーム -->
  <h2>新規投稿</h2>
  <form method="POST">
    <input type="hidden" name="action" value="post">
    <input type="text" name="name" placeholder="名前" required><br>
    <textarea name="message" placeholder="メッセージ" required></textarea><br>
    <button type="submit">投稿する</button>
  </form>

  <hr>

  <!-- 投稿一覧 -->
  <h2>投稿一覧（<?php echo count($posts); ?>件）</h2>

  <?php if (empty($posts)): ?>
    <p>まだ投稿がありません。</p>
  <?php else: ?>
    <?php foreach ($posts as $post): ?>
      <div style="border: 1px solid #ccc; padding: 10px; margin: 10px 0;">
        <p><strong><?php echo $post['name']; ?></strong> - <?php echo $post['created_at']; ?></p>
        <p><?php echo nl2br($post['message']); ?></p>
        <form method="POST" style="display: inline;" 
              onsubmit="return confirm('削除しますか？');">
          <input type="hidden" name="action" value="delete">
          <input type="hidden" name="id" value="<?php echo $post['id']; ?>">
          <button type="submit">削除</button>
        </form>
      </div>
    <?php endforeach; ?>
  <?php endif; ?>
</body>
</html>
```

### 🔧 5-3. 重要ポイント

#### **ポイント1：データの永続化**

```php
// JavaScriptとの違い
// ❌ JavaScript: ブラウザを閉じたら消える
// ✅ PHP: サーバーに永続保存

$posts = json_decode(file_get_contents('posts.json'), true);
$posts[] = $new_post;
file_put_contents('posts.json', json_encode($posts));
```

#### **ポイント2：XSS対策**

```php
// ❌ 危険
echo $post['message'];

// ✅ 安全
echo htmlspecialchars($post['message'], ENT_QUOTES, 'UTF-8');
```

#### **ポイント3：PRGパターン（Post-Redirect-Get）**

```php
// フォーム送信後、必ずリダイレクト
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
  // データ処理
  header('Location: board.php');
  exit;
}
// これで二重送信を防ぐ
```

---

## 🏁 ゴール確認チェックリスト

- [ ] クライアントサイドとサーバーサイドの違いを説明できる
- [ ] GETとPOSTの違いを説明できる
- [ ] PHPの基本文法を理解している
- [ ] `$_GET`と`$_POST`が使える
- [ ] `htmlspecialchars()`でエスケープできる
- [ ] JSONでデータを保存・読み込みできる
- [ ] 簡易掲示板を作成できた

---

## 🚀 次のステップへ

**重要なポイントのおさらい：**

1. **データはサーバー側で永続的に保存する**
2. **ユーザー入力は必ずエスケープする（セキュリティ）**
3. **POST後はリダイレクトする（PRGパターン）**

**次は「ステップ④ Laravel」で、本格的なフレームワークを学びます！**

---

## 💡 FAQ

**Q1: なぜJavaScriptではなくPHPを使うの？**

A: JavaScriptはブラウザで実行されるため、データを永続保存したり、他のユーザーとデータを共有できません。PHPはサーバー側で実行されるため、これらが可能になります。

**Q2: htmlspecialchars()を忘れたらどうなる？**

A: XSS攻撃を受ける可能性があります。悪意のあるユーザーがスクリプトを投稿すると、他のユーザーのブラウザで実行されてしまいます。

**Q3: JSONファイルとデータベースの違いは？**

A: JSONファイルは簡単ですが、データが大量になると遅くなります。データベース（MySQL等）は高速で、複雑な検索も可能です。次のステップで学びます。

---

**🎉 ステップ③完了です！**
